
format COFF

extrn nbox_hook_handler

public handler as 'fasm_hook_handler'

handler:
    label RetAddr   dword at ebp + 36

    pushad
    pushfd
    mov ebp, esp
    mov eax, [RetAddr]
    sub eax, 5              ; HookAddr
    push eax
    call nbox_hook_handler  ; It should return the address of Trampoline[HookAddr]
    mov [RetAddr], eax
    popfd
    popad
    ret                     ; Jump to Trampoline

